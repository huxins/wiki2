(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{313:function(e,a,s){"use strict";s.r(a);var t=s(14),r=Object(t.a)({},(function(){var e=this,a=e._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"shadow-utils"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#shadow-utils"}},[e._v("#")]),e._v(" Shadow-utils")]),e._v(" "),a("h2",{attrs:{id:"understand-the-etc-passwd-file"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#understand-the-etc-passwd-file"}},[e._v("#")]),e._v(" Understand the /etc/passwd file")]),e._v(" "),a("p",[e._v("用户帐户信息存储在 "),a("code",[e._v("/etc/passwd")]),e._v(" 文件中。此信息包括帐户名称，主目录位置和默认 shell 以及其他值。")]),e._v(" "),a("p",[e._v("每个字段由 "),a("code",[e._v(":")]),e._v(" 字符分隔，并非所有字段都必须填充，但您必须对它们进行描述。")]),e._v(" "),a("p",[e._v("以下是 "),a("code",[e._v("/etc/passwd")]),e._v(" 字段的示例：")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("username:password:UID:GID:comment:home:shell\n")])])]),a("p",[e._v("默认情况下，Linux 系统会自动按照从 1000 开始的数字顺序将 UID 和 GID 分配给新用户帐户。换句话说，如果您在安装过程中创建一个新的用户帐户，它将具有 UID = 1000 和 GID = 1000，如下所示：")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("khess:x:1000:1000:Ken Hess:/home/khess:/bin/bash\n")])])]),a("p",[e._v("这种任意分配背后的理论是，低于 1000 的任何东西都保留给系统帐户、服务和其他特殊帐户，而普通用户 UID 和 GID 保持在 1000 以上。该理论基于这样的假设，即 999 个帐号减去一些预先分配的帐号，足以满足大多数系统多年的需求。")]),e._v(" "),a("p",[e._v("root 帐户拥有 UID = 0 和 GID = 0 的令人敬畏的特权。这些数字赋予了 root 帐户压倒性的力量。")]),e._v(" "),a("p",[e._v("在许多 Unix 和 Linux 发行版中，nobody 用户是伪用户。根据 "),a("a",{attrs:{href:"https://refspecs.linuxbase.org/LSB_3.0.0/LSB-PDA/LSB-PDA/usernames.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Linux Standard Base"),a("OutboundLink")],1),e._v("。")]),e._v(" "),a("h2",{attrs:{id:"understand-the-etc-shadow-file"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#understand-the-etc-shadow-file"}},[e._v("#")]),e._v(" Understand the /etc/shadow file")]),e._v(" "),a("p",[e._v("很久以前，密码哈希存储在 "),a("code",[e._v("/etc/passwd")]),e._v(" 文件中。这个文件是世界可读的，允许好奇的用户从文件中提取其他帐户的密码哈希，并通过密码破解实用程序运行它们。最终，密码散列被移动到一个只有 root 才能读取的文件："),a("code",[e._v("/etc/shadow")]),e._v("。今天，"),a("code",[e._v("/etc/passwd")]),e._v(" 文件中的密码字段标有 "),a("code",[e._v("x")]),e._v("。")]),e._v(" "),a("p",[e._v("管理员应该识别 "),a("code",[e._v("/etc/shadow")]),e._v(" 中的每个字段。有几个字段与密码要求有关。")]),e._v(" "),a("p",[e._v("以下是 "),a("code",[e._v("/etc/shadow")]),e._v(" 字段的示例：")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("username:password:last password change:min:max:warning:inactive:expired:reserved for future use\n")])])]),a("h2",{attrs:{id:"managing-user-accounts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#managing-user-accounts"}},[e._v("#")]),e._v(" Managing user accounts")]),e._v(" "),a("h3",{attrs:{id:"adding-user-accounts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#adding-user-accounts"}},[e._v("#")]),e._v(" Adding user accounts")]),e._v(" "),a("p",[a("code",[e._v("useradd")]),e._v(" 通过 "),a("a",{attrs:{href:"https://github.com/shadow-maint/shadow/blob/4.6/src/useradd.c#L2190",target:"_blank",rel:"noopener noreferrer"}},[e._v("pam_start"),a("OutboundLink")],1),e._v(" 调用 PAM 的 "),a("a",{attrs:{href:"https://github.com/linux-pam/linux-pam/blob/Linux-PAM-1_1_8/libpam/pam_start.c#L18",target:"_blank",rel:"noopener noreferrer"}},[e._v("pam_start"),a("OutboundLink")],1),e._v(" 函数来实现创建新用户或更新默认新用户信息。")]),e._v(" "),a("p",[a("code",[e._v("adduser")]),e._v(" 是一个 "),a("code",[e._v("perl")]),e._v(" 脚本，它在后端使用 "),a("code",[e._v("useradd")]),e._v(" 二进制文件。")]),e._v(" "),a("p",[e._v("在 "),a("code",[e._v("adduser")]),e._v(" 命令中，使用 "),a("code",[e._v("--system")]),e._v(" 选项来创建系统用户。它不会将 "),a("code",[e._v("/etc/skel")]),e._v(" 复制到主目录。系统用户将使用 "),a("code",[e._v("/usr/sbin/nologin")]),e._v(" 并且默认属于 "),a("code",[e._v("nogroup")]),e._v("，要将新系统用户放在具有相同 ID 的新组中，请使用 "),a("code",[e._v("--group")]),e._v(" 选项。")]),e._v(" "),a("p",[e._v("当您创建帐户以运行守护程序、服务或其他系统软件时，而不是创建用于交互使用的帐户，建议使用系统账户。将用户和软件帐户保持在数字空间的不同部分有长期的好处。大多数情况下，它可以很容易地判断帐户是什么，以及人类是否应该能够登录。")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("--system")]),e._v("：创建一个系统帐户，默认。\n"),a("ul",[a("li",[e._v("expiry date 为 never，保存于 "),a("code",[e._v("/etc/shadow")]),e._v("。")]),e._v(" "),a("li",[e._v("uid 低于 999，就像在 "),a("code",[e._v("/etc/login.defs")]),e._v(" 上设置的一样。")])])]),e._v(" "),a("li",[a("code",[e._v("--shell")]),e._v("：用户登录 shell 的名称。")]),e._v(" "),a("li",[a("code",[e._v("-c")]),e._v("：它通常是对登录名的简短描述，目前用作用户全名的字段。")]),e._v(" "),a("li",[a("code",[e._v("--home")]),e._v("：用户登录目录。")]),e._v(" "),a("li",[a("code",[e._v("-m")]),e._v("：如果用户的主目录不存在，则创建它。")]),e._v(" "),a("li",[a("code",[e._v("-M")]),e._v("：不要创建用户的主目录。")]),e._v(" "),a("li",[a("code",[e._v("-g")]),e._v("：用户初始登录组的组名或编号，该组必须已经存在。")]),e._v(" "),a("li",[a("code",[e._v("-G")]),e._v("：新增用户也是其成员的补充组列表。")])]),e._v(" "),a("h3",{attrs:{id:"removing-user-accounts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#removing-user-accounts"}},[e._v("#")]),e._v(" Removing user accounts")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("userdel -r <username>")]),e._v("：用户主目录中的文件将连同主目录本身和用户的 mail spool 一起被删除。")])]),e._v(" "),a("h3",{attrs:{id:"manage-password-requirements"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#manage-password-requirements"}},[e._v("#")]),e._v(" Manage password requirements")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("chage -l <username>")]),e._v("：显示帐户帐龄信息。")]),e._v(" "),a("li",[a("code",[e._v("passwd <username>")]),e._v("：修改密码。\n"),a("ul",[a("li",[a("code",[e._v("passwd -S <username>")]),e._v("：显示帐户密码状态的简短信息。")]),e._v(" "),a("li",[a("code",[e._v("passwd -e <username>")]),e._v("：配置帐户密码过期。")]),e._v(" "),a("li",[a("code",[e._v("passwd -l <username>")]),e._v("：锁定指定帐户。")]),e._v(" "),a("li",[a("code",[e._v("passwd -u <username>")]),e._v("：解锁指定帐户。")]),e._v(" "),a("li",[a("code",[e._v("passwd -n <mindays> <username>")]),e._v("：设置最短密码生命周期。")]),e._v(" "),a("li",[a("code",[e._v("passwd -x <maxdays> <username>")]),e._v("：设置最长密码生命周期。")]),e._v(" "),a("li",[a("code",[e._v("passwd -w <warndays> <username>")]),e._v("：设置密码过期警告的提前天数。")]),e._v(" "),a("li",[a("code",[e._v("passwd -i <inactivedays> <username>")]),e._v("：密码有效期内非活动状态达到多少天应被禁用。")])])])]),e._v(" "),a("h2",{attrs:{id:"references"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[e._v("#")]),e._v(" References")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://unix.stackexchange.com/questions/619654/what-does-the-system-flag-for-adduser-do",target:"_blank",rel:"noopener noreferrer"}},[e._v("Stack Exchange - What does the --system flag for adduser do"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://serverfault.com/questions/350931/in-what-condition-should-i-create-a-system-user-instead-of-a-normal-user",target:"_blank",rel:"noopener noreferrer"}},[e._v("Stack Exchange - In what condition, should I create a system user instead of a normal user"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://unix.stackexchange.com/questions/80277/whats-the-difference-between-a-normal-user-and-a-system-user",target:"_blank",rel:"noopener noreferrer"}},[e._v("Stack Exchange - What's the difference between a normal user and a system user"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://askubuntu.com/questions/345974/what-is-the-difference-between-adduser-and-useradd",target:"_blank",rel:"noopener noreferrer"}},[e._v("Stack Exchange - What is the difference between adduser and useradd"),a("OutboundLink")],1)]),e._v(" "),a("li",[a("a",{attrs:{href:"https://www.redhat.com/sysadmin/linux-commands-manage-users",target:"_blank",rel:"noopener noreferrer"}},[e._v("Red Hat - 3 basic Linux user management commands every sysadmin should know"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=r.exports}}]);